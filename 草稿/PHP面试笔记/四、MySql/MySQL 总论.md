MySQL 总论
===


mysql基础
---

请写出下列mysql 数据类型表示的意义 int0 char16 varchar16 datetime text

### 考点
- MySQL 数据类型
- MySQL 基础操作
- MySQL 存储引擎
- MySQL 锁机制
- MySQL 事务处理，存储过程，触发器

### MySQL 数据类型
#### 整数类型
- TINYINT  SMALLINT MEDIUMINT INT BIGINT
- 属性 unsigned
- 长度 可以为整数指定宽度，例如int(11)，单实际上，对大多数应用是没意义的，它不会超过限制值的合法范围，只会影响显示字符的个数。
也就是说 例如你设为int(3) 你照样可以存1234,只是你存1 的时候设置零填充会填充为001 保证3位。如果没设置zerofill就不会零填充。
- int类型不管怎么存都是11，写int3是无意义的
#### 实数类型
- FLOAT DOUBLE 
FLOAT DOUBLE 支持使用标准的浮点来进行近似的计算。也就是说要在数据库中做计算的话FLOAT DOUBLE 比DECIMAL 更合适
- DECIMAL
可存储比BIGINT还大的整数，可以用于存储精确的小数

#### 字符串类型
- varchar
用于存储可变长度的字符串，比定长更省空间
varchar 使用1个或两个额外字节记录字符串长度，列长度小于255个字节时使用1个字节表示，否则用两个
如果存储的内容超出指定长度，会被截断
- char
char 是定长的，根据定义的字符串长度分配足够的空间
char 会根据需要采用空格进行填充以方便比较
char 适合存储比较短的字符串，或者所有的值都接近同一个长度(例如密码hash后都是32 -> char32 )
char 长度超出设定的长度，会被截断
- text
- BLOB
- 总结
对于经常变更的数据，char比varchar更好，char不容易产生碎片
对于比较短的列，char比varchar在存储空间上更有效率
只分配真正的空间，更长的列会消耗更长的空间
尽量避免使用BLOB和text类型，查询会使用临时表，导致严重的性能开销。

#### 枚举类型
有时候可以使用枚举替代常用的字符串类型
把不重复的集合存储成一个预定义集合
非常紧凑，把列表值压缩到一个或两个字节
内部存储的是整数
尽量避免使用数字作为枚举的常量，易混乱。
排序是按照内部存储的整数来进行排序的
枚举表会使表大小大大减小

#### 日期和时间类型
尽量使用timestamp，比datetime 空间效率更高
用整数存储时间戳格式通常不方便处理
如果要存储微秒，可以使用bigint存储

### 列属性
- auto_increment
- default
- not null
- zerofill

### 基础操作
- mysql  -u -p -h -P
- \G 格式化显示 \c 取消当前命令 \q 退出 \s \h 帮助信息 \d  

### 引擎

#### innodb
默认的事务型引擎，最重要最广泛的存储引擎，	性能非常优秀
数据存储在共享表空间 ，可以通过配置分开
对主键查询的性能高于其他类型的存储引擎
内部做了优化，从磁盘读取数据时自动在内存构建hash索引
插入数据时自动构建插入缓冲区

通过一些机制和工具实现真正的热备份
支持奔溃后的安全恢复
支持行级锁
支持外键

#### myisam
5.1以前是默认的引擎
拥有全文索引，压缩，空间函数
不支持事务和行级锁，不支持奔溃后的安全恢复
表不使用共享表空间，表存储在两个文件，MYD（数据文件）和MYI（索引文件）
设计简单，某些场景下性能很好

#### 其他引擎
Archive Blackhole CSV Memory	

### 锁
#### 锁机制 
> 当多个查询同一时刻进行数据修改时，就会产生并发控制的问题

- 分为共享锁和排他锁，其实就是读锁和写锁
- 读锁是共享的，不堵塞，多个用户可以同时读一个资源，互不干扰
- 写锁是排他的，一个写锁可以阻塞其他写锁和读锁，这样只允许一个人进行写入，防止其他用户读取正在写入的资源

#### 锁粒度
- 表锁，系统性能开销最小，会锁定整张表，myisam使用表锁
- 行锁，最大程度地支持并发处理，但是也带来了最大的锁开销，Innodb使用行级锁

### 事务处理
- mysql提供事务处理的表引擎，Innodb
- 服务器不管理事务，由下层引擎实现，所以在同一个事务中，使用多种存储引擎是不靠谱的
- 在非事务的表上执行事务操作，mysql不会提醒也不会报错。

### 存储过程
- 为以后的使用而保存一条或是多条MySQL语句的集合
- 存储过程就是有业务逻辑和流程的集合
- 可以在存储过程中创建表，更新数据，删除等
- 使用场景 
通过把处理封装在容易使用的单元里，简化复杂操作
保证数据的一致性
简化对变动的管理

### 触发器
> 提供给程序员和数据分析员来保证数据完整性一种方法，它是与表事件相关的特殊存储过程

- 使用场景
可通过数据库中的相关表进行级联更改
实时监控某张表中的某个字段的更改而需要做出相应的处理
某些业务编号的生成
滥用会造成数据库及应用程序的维护困难

### 面试题
请说明表存储引擎Innodb和myisam的区别


delete

Insert into ......  ON DUPLICATE KEY 
update 失败 执行 insert

---

