{"compress":true,"commitItems":[["7782ef2d-27d7-419f-934b-751e93613085",1525058718141,"",[[1525058691818,["fangle@fangle-PC",[[1,0,"常见的nginx中间件架构\n===\n\n\n常见的nginx中间件架构\n- 静态资源服务\n- 代理服务\n- 七层负载均衡调度器(SLB)\n- 动态缓存\n\n静态资源web服务\n静态资源web服务相关配置\n```\nsendfile on   #开启sendfile机制从内核优化\n```\n新版本还可以在编译时增加参数`--with-file-aio`开启异步文件读取。这个现在应用认可度还不是很高，具体了解可以查看nginx的aio模块\n\ntcp-nopush\n把多个包一次性整合之后再发送给客户端，而不是一次次发，在sendfile开启的情况下，提高网络包的传输效率，可在http、server和location中配置，默认是关闭(off)状态\n\ntcp-nodelay\n数据包实时发送，不用等待，主要应用在实时性要求比较高的场景。在keepalive连接下，提高网络包的传输实时性。\n\n压缩\n`gzip on` 压缩传输，减少消耗带宽资源，提高网络传输效率\n`gzip_comp_level level` 压缩级别\n`gzip_http_version 1.0|1.1` 压缩版本\n\n扩展nginx压缩模块\nhttp_gzip_static_module 预读gzip模块\n开启该功能，如果访问1.jpg文件会在目录下现在预压缩的1.jpg.gzip文件。预先压缩好，减少压缩时间\nhttp_gunzip_module 应用支持gunzip压缩方式，为了支持某些浏览器不支持gzip的压缩包，应用比较少。\n\n浏览器缓存-expires\n添加Cache-Control,Expries头\n`expires 24h` 设置缓存时间24h\n\nheader头设置-add_header name value\n`add_header Access-Control-Allow-Origin www.baidu.com` 开启允许从这个域名跨域过来访问\n`add_header Access-Control-Allow-Methods GET,POST,PUT `设置允许跨域的请求方法\n\n防盗链\n防盗链的解决思路：区分哪些是非正常用户的请求\n基于http_refer防盗链配置模块`valid_referers none blocked`"]],[0,0],[962,962]]],[1525058697780,["fangle@fangle-PC",[[1,20,"### "]],[20,20],[24,24]]],[1525058708223,["fangle@fangle-PC",[[1,79,"#### "]],[79,79],[84,84]]],[1525058712619,["fangle@fangle-PC",[[1,94,"- "]],[94,94],[96,96]]],[1525058726414,["fangle@fangle-PC",[[1,227,"- "]],[227,227],[229,229]]],[1525058729166,["fangle@fangle-PC",[[1,334,"- "]],[334,334],[336,336]]],[1525058731806,["fangle@fangle-PC",[[1,406,"- "]],[406,406],[408,408]]],[1525058739269,["fangle@fangle-PC",[[1,507,"- "]],[507,507],[509,509]]],[1525058747445,["fangle@fangle-PC",[[1,671,"- "]],[671,671],[673,673]]],[1525058760184,["fangle@fangle-PC",[[1,678,"设置"]],[678,678],[680,680]]],[1525058763094,["fangle@fangle-PC",[[1,739,"\n"]],[738,738],[739,739]]],[1525058773231,["fangle@fangle-PC",[[1,739,"- 跨域访问设置"]],[739,739],[747,747]]],[1525058776524,["fangle@fangle-PC",[[1,919,"- "]],[919,919],[921,921]]],[1525058784515,["fangle@fangle-PC",[[1,996,"\n\n"]],[996,996],[997,997]]],[1525058784680,["fangle@fangle-PC",[[1,998,"\n"]],[997,997],[998,998]]],[1525058794874,["fangle@fangle-PC",[[-1,998,"\n"],[1,999,"#### 代理服务"]],[998,998],[1007,1007]]],[1525058795137,["fangle@fangle-PC",[[1,1007,"\n\n"]],[1007,1007],[1008,1008]]],[1525058823949,["fangle@fangle-PC",[[-1,1008,"\n"],[1,1009,"#### 负载均衡"]],[1008,1008],[1017,1017]]],[1525058824296,["fangle@fangle-PC",[[1,1017,"\n\n"]],[1017,1017],[1018,1018]]],[1525058834308,["fangle@fangle-PC",[[-1,1018,"\n"],[1,1019,"#### 动态缓存"]],[1018,1018],[1027,1027]]],[1525058834704,["fangle@fangle-PC",[[1,1027,"\n\n"]],[1027,1027],[1028,1028]]],[1525058875898,["fangle@fangle-PC",[[1,1008,"\n"]],[1007,1007],[1008,1008]]],[1525058878010,["fangle@fangle-PC",[[1,1008,"httpd"]],[1008,1008],[1013,1013]]],[1525058878688,["fangle@fangle-PC",[[-1,1012,"d"]],[1013,1013],[1012,1012]]],[1525058890681,["fangle@fangle-PC",[[1,1012,"代理 -》"]],[1012,1012],[1017,1017]]],[1525058891420,["fangle@fangle-PC",[[-1,1016,"》"]],[1017,1017],[1016,1016]]],[1525058894788,["fangle@fangle-PC",[[1,1016,"> h"]],[1016,1016],[1019,1019]]],[1525058897058,["fangle@fangle-PC",[[-1,1016,"> h"]],[1019,1019],[1016,1016]]],[1525058903747,["fangle@fangle-PC",[[1,1016,"> Http Server"]],[1016,1016],[1029,1029]]],[1525058904644,["fangle@fangle-PC",[[1,1030,"\n"]],[1029,1029],[1030,1030]]],[1525058920604,["fangle@fangle-PC",[[1,1030,"ICMP\\POP\\IMAP "]],[1030,1030],[1044,1044]]],[1525058921688,["fangle@fangle-PC",[[-1,1043," "]],[1044,1044],[1043,1043]]],[1525058927993,["fangle@fangle-PC",[[1,1043,"代理 -》"]],[1043,1043],[1048,1048]]],[1525058928700,["fangle@fangle-PC",[[-1,1047,"》"]],[1048,1048],[1047,1047]]],[1525058930743,["fangle@fangle-PC",[[1,1047,"》"]],[1047,1047],[1048,1048]]],[1525058931389,["fangle@fangle-PC",[[-1,1047,"》"]],[1048,1048],[1047,1047]]],[1525058938968,["fangle@fangle-PC",[[1,1047,"> Mail代理"]],[1047,1047],[1055,1055]]],[1525058939248,["fangle@fangle-PC",[[1,1056,"\n"]],[1055,1055],[1056,1056]]],[1525058947523,["fangle@fangle-PC",[[1,1056,"Httpsd"]],[1056,1056],[1062,1062]]],[1525058948024,["fangle@fangle-PC",[[-1,1061,"d"]],[1062,1062],[1061,1061]]],[1525058953036,["fangle@fangle-PC",[[1,1061,"代理 -》"]],[1061,1061],[1066,1066]]],[1525058953539,["fangle@fangle-PC",[[-1,1065,"》"]],[1066,1066],[1065,1065]]],[1525058958041,["fangle@fangle-PC",[[1,1065,">H"]],[1065,1065],[1067,1067]]],[1525058963052,["fangle@fangle-PC",[[1,1067,"ttp Server "]],[1067,1067],[1078,1078]]],[1525058967635,["fangle@fangle-PC",[[-1,1053,"代理"]],[1055,1055],[1053,1053]]],[1525058970703,["fangle@fangle-PC",[[1,1053," Server"]],[1053,1053],[1060,1060]]],[1525058972549,["fangle@fangle-PC",[[1,1084,"\n"]],[1083,1083],[1084,1084]]],[1525058979905,["fangle@fangle-PC",[[1,1084,"RTMP da"]],[1084,1084],[1091,1091]]],[1525058980427,["fangle@fangle-PC",[[-1,1089,"da"]],[1091,1091],[1089,1089]]],[1525058982009,["fangle@fangle-PC",[[1,1089,"代理"]],[1089,1089],[1091,1091]]],[1525058990080,["fangle@fangle-PC",[[-1,1008,"h"]],[1009,1009],[1008,1008]]],[1525058991648,["fangle@fangle-PC",[[1,1008,"H"]],[1008,1008],[1009,1009]]],[1525058994510,["fangle@fangle-PC",[[-1,1088," "]],[1089,1089],[1088,1088]]],[1525059011723,["fangle@fangle-PC",[[1,1090," -> Media Server"]],[1090,1090],[1106,1106]]],[1525059026554,["fangle@fangle-PC",[[1,1107,"\n"]],[1106,1106],[1107,1107]]],[1525059027155,["fangle@fangle-PC",[[1,1108,"\n"]],[1107,1107],[1108,1108]]],[1525059028374,["fangle@fangle-PC",[[1,1109,"\n"]],[1107,1107],[1108,1108]]],[1525059048372,["fangle@fangle-PC",[[1,1108,"- zh"]],[1108,1108],[1112,1112]]],[1525059049226,["fangle@fangle-PC",[[-1,1110,"zh"]],[1112,1112],[1110,1110]]],[1525059052124,["fangle@fangle-PC",[[1,1110,"正像"]],[1110,1110],[1112,1112]]],[1525059053098,["fangle@fangle-PC",[[-1,1111,"像"]],[1112,1112],[1111,1111]]],[1525059058532,["fangle@fangle-PC",[[1,1111,"向代理"]],[1111,1111],[1114,1114]]],[1525059058853,["fangle@fangle-PC",[[1,1116,"\n"]],[1114,1114],[1115,1115]]],[1525059104545,["fangle@fangle-PC",[[1,1115,"- 反向代理"]],[1115,1115],[1121,1121]]],[1525059128541,["fangle@fangle-PC",[[1,1123,"\n"]],[1121,1121],[1122,1122]]],[1525059129796,["fangle@fangle-PC",[[1,1122,"- "]],[1122,1122],[1124,1124]]],[1525059154039,["fangle@fangle-PC",[[1,1124,"正向代理和反向代理的区别在于代理的对象不一样呀"]],[1124,1124],[1147,1147]]],[1525059154356,["fangle@fangle-PC",[[-1,1146,"呀"]],[1147,1147],[1146,1146]]],[1525059177524,["fangle@fangle-PC",[[1,1146,"，正向代理的对象是客户端，方向代理的对象是服务端"]],[1146,1146],[1170,1170]]],[1525059242218,["fangle@fangle-PC",[[1,1122,"\n"]],[1121,1121],[1122,1122]]],[1525059254840,["fangle@fangle-PC",[[1,1122,"proxy_pass "]],[1122,1122],[1133,1133]]],[1525059259050,["fangle@fangle-PC",[[1,1133,"URl"]],[1133,1133],[1136,1136]]],[1525059260034,["fangle@fangle-PC",[[-1,1135,"l"]],[1136,1136],[1135,1135]]],[1525059260652,["fangle@fangle-PC",[[1,1135,"L;"]],[1135,1135],[1137,1137]]],[1525072585761,["fangle@fangle-PC",[[1,1188,"\n"]],[1187,1187],[1188,1188]]],[1525072587881,["fangle@fangle-PC",[[1,1188,"-"]],[1188,1188],[1189,1189]]],[1525072588768,["fangle@fangle-PC",[[-1,1188,"-"]],[1189,1189],[1188,1188]]],[1525072589124,["fangle@fangle-PC",[[-1,1188,"\n"]],[1188,1188],[1187,1187]]],[1525072589807,["fangle@fangle-PC",[[1,1187,"-"]],[1187,1187],[1188,1188]]],[1525072590557,["fangle@fangle-PC",[[1,1189,"\n"]],[1188,1188],[1189,1189]]],[1525072650544,["fangle@fangle-PC",[[1,1188,"## proxy_buffering"]],[1188,1188],[1206,1206]]],[1525072654056,["fangle@fangle-PC",[[-1,1188,"## "]],[1188,1191],[1188,1188]]],[1525072654781,["fangle@fangle-PC",[[1,1188," "]],[1188,1188],[1189,1189]]],[1525072659244,["fangle@fangle-PC",[[1,1204," on"]],[1204,1204],[1207,1207]]],[1525072662915,["fangle@fangle-PC",[[1,1189,"·"]],[1189,1189],[1190,1190]]],[1525072663854,["fangle@fangle-PC",[[-1,1189,"·"]],[1190,1190],[1189,1189]]],[1525072664157,["fangle@fangle-PC",[[1,1189,"~"]],[1189,1189],[1190,1190]]],[1525072664898,["fangle@fangle-PC",[[-1,1189,"~"]],[1190,1190],[1189,1189]]],[1525072665604,["fangle@fangle-PC",[[1,1189,"`"]],[1189,1189],[1190,1190]]],[1525072673924,["fangle@fangle-PC",[[1,1208,"`\t"]],[1208,1208],[1210,1210]]],[1525072707680,["fangle@fangle-PC",[[1,1210,"响应缓存"]],[1210,1210],[1214,1214]]],[1525072708248,["fangle@fangle-PC",[[-1,1213,"存"]],[1214,1214],[1213,1213]]],[1525072726471,["fangle@fangle-PC",[[1,1213,"冲区，减少IO资料"]],[1213,1213],[1222,1222]]],[1525072727741,["fangle@fangle-PC",[[-1,1220,"资料"]],[1222,1222],[1220,1220]]],[1525072729097,["fangle@fangle-PC",[[1,1220,"消耗"]],[1220,1220],[1222,1222]]],[1525072937149,["fangle@fangle-PC",[[1,1234,"\n"]],[1233,1233],[1234,1234]]],[1525072937692,["fangle@fangle-PC",[[1,1235,"\n"]],[1234,1234],[1235,1235]]],[1525072948270,["fangle@fangle-PC",[[-1,1235,"\n"]],[1235,1235],[1234,1234]]],[1525073105584,["fangle@fangle-PC",[[1,1234,"四层负载均衡"]],[1234,1234],[1240,1240]]],[1525073106063,["fangle@fangle-PC",[[1,1241,"\n"]],[1240,1240],[1241,1241]]],[1525073112115,["fangle@fangle-PC",[[1,1241,"七层负载均衡"]],[1241,1241],[1247,1247]]],[1525073115272,["fangle@fangle-PC",[[1,1240,"-》"]],[1240,1240],[1242,1242]]],[1525073115900,["fangle@fangle-PC",[[-1,1241,"》"]],[1242,1242],[1241,1241]]],[1525073116840,["fangle@fangle-PC",[[1,1241,">"]],[1241,1241],[1242,1242]]],[1525073117914,["fangle@fangle-PC",[[1,1240," "]],[1240,1240],[1241,1241]]],[1525073120014,["fangle@fangle-PC",[[1,1243," zu"]],[1243,1243],[1246,1246]]],[1525073121013,["fangle@fangle-PC",[[-1,1244,"zu"]],[1246,1246],[1244,1244]]],[1525073138368,["fangle@fangle-PC",[[1,1244,"作用于OSI网络模型第四层TCP层控制"]],[1244,1244],[1263,1263]]],[1525073142356,["fangle@fangle-PC",[[1,1270," -》"]],[1270,1270],[1273,1273]]],[1525073143012,["fangle@fangle-PC",[[-1,1272,"》"]],[1273,1273],[1272,1272]]],[1525073143893,["fangle@fangle-PC",[[1,1272,">"]],[1272,1272],[1273,1273]]],[1525073154299,["fangle@fangle-PC",[[1,1263,",zhi"]],[1263,1263],[1267,1267]]],[1525073155238,["fangle@fangle-PC",[[-1,1264,"zhi"]],[1267,1267],[1264,1264]]],[1525073158980,["fangle@fangle-PC",[[1,1264,"只需有"]],[1264,1264],[1267,1267]]],[1525073159474,["fangle@fangle-PC",[[-1,1266,"有"]],[1267,1267],[1266,1266]]],[1525073167662,["fangle@fangle-PC",[[1,1266,"要进行包转发"]],[1266,1266],[1272,1272]]],[1525073178833,["fangle@fangle-PC",[[1,1282," 作用于应用层，"]],[1282,1282],[1290,1290]]],[1525073181767,["fangle@fangle-PC",[[1,1272,"，效率"]],[1272,1272],[1275,1275]]],[1525073183124,["fangle@fangle-PC",[[1,1275,"高"]],[1275,1275],[1276,1276]]],[1525073199915,["fangle@fangle-PC",[[1,1294,"nginx就是典型的七层负载均衡器"]],[1294,1294],[1311,1311]]],[1525073213139,["fangle@fangle-PC",[[1,1312,"\n"]],[1311,1311],[1312,1312]]],[1525073230129,["fangle@fangle-PC",[[1,1312,"nginx的负载均衡服务主要接祖"]],[1312,1312],[1328,1328]]],[1525073231103,["fangle@fangle-PC",[[-1,1326,"接祖"]],[1328,1328],[1326,1326]]],[1525073237127,["fangle@fangle-PC",[[1,1326,"借"]],[1326,1326],[1327,1327]]],[1525073259756,["fangle@fangle-PC",[[1,1327,"助于proxy_pass,he"]],[1327,1327],[1342,1342]]],[1525073260961,["fangle@fangle-PC",[[-1,1339,",he"]],[1342,1342],[1339,1339]]],[1525073264277,["fangle@fangle-PC",[[1,1339,"和upstream"]],[1339,1339],[1348,1348]]],[1525073265346,["fangle@fangle-PC",[[1,1349,"\n"]],[1348,1348],[1349,1349]]],[1525073265849,["fangle@fangle-PC",[[1,1350,"\n"]],[1349,1349],[1350,1350]]],[1525073276781,["fangle@fangle-PC",[[1,1312,"\n"]],[1312,1312],[1313,1313]]],[1525073277691,["fangle@fangle-PC",[[1,1313,"- "]],[1313,1313],[1315,1315]]],[1525073295917,["fangle@fangle-PC",[[1,1352,"- upstream 必须配置在server层以为"]],[1352,1352],[1377,1377]]],[1525073296297,["fangle@fangle-PC",[[-1,1376,"为"]],[1377,1377],[1376,1376]]],[1525073297293,["fangle@fangle-PC",[[1,1376,"外"]],[1376,1376],[1377,1377]]],[1525073297995,["fangle@fangle-PC",[[1,1379,"\n"]],[1377,1377],[1378,1378]]],[1525073832671,["fangle@fangle-PC",[[1,1378,"- 调度算法"]],[1378,1378],[1384,1384]]],[1525073837960,["fangle@fangle-PC",[[1,1380,"负载均衡"]],[1380,1380],[1384,1384]]],[1525073841799,["fangle@fangle-PC",[[1,1388,"有多重"]],[1388,1388],[1391,1391]]],[1525073842216,["fangle@fangle-PC",[[-1,1390,"重"]],[1391,1391],[1390,1390]]],[1525073844121,["fangle@fangle-PC",[[1,1390,"种，"]],[1390,1390],[1392,1392]]],[1525073852951,["fangle@fangle-PC",[[1,1392,"其中一种就是IPhash，解决"]],[1392,1392],[1407,1407]]],[1525073853540,["fangle@fangle-PC",[[-1,1405,"解决"]],[1407,1407],[1405,1405]]],[1525073873253,["fangle@fangle-PC",[[1,1405,"主要是为了解决不同请求打到不同的"]],[1405,1405],[1421,1421]]],[1525073876256,["fangle@fangle-PC",[[-1,1416,"打到不同的"]],[1421,1421],[1416,1416]]],[1525073889507,["fangle@fangle-PC",[[1,1416,"调度到不同的服务器，如何"]],[1416,1416],[1428,1428]]],[1525073890254,["fangle@fangle-PC",[[-1,1426,"如何"]],[1428,1428],[1426,1426]]],[1525073904007,["fangle@fangle-PC",[[1,1426,"然后session失效的问题。使用ip"]],[1426,1426],[1445,1445]]],[1525073909925,["fangle@fangle-PC",[[1,1445,"hash调度算法 "]],[1445,1445],[1454,1454]]],[1525073910625,["fangle@fangle-PC",[[-1,1453," "]],[1454,1454],[1453,1453]]],[1525073930108,["fangle@fangle-PC",[[1,1453,"，能使同一个ip的请求调度到同一台服务器上"]],[1453,1453],[1474,1474]]],[1525074049708,["fangle@fangle-PC",[[1,1475,"- hash"]],[1475,1475],[1481,1481]]],[1525074056740,["fangle@fangle-PC",[[-1,1475,"- hash"]],[1481,1481],[1475,1475]]],[1525074186058,["fangle@fangle-PC",[[-1,1486,"\n"],[1,1487,"proxy_"]],[1486,1486],[1492,1492]]],[1525074186677,["fangle@fangle-PC",[[-1,1491,"_"]],[1492,1492],[1491,1491]]],[1525074188209,["fangle@fangle-PC",[[1,1491,"-ca"]],[1491,1491],[1494,1494]]],[1525074189439,["fangle@fangle-PC",[[-1,1491,"-ca"]],[1494,1494],[1491,1491]]],[1525074191279,["fangle@fangle-PC",[[1,1491,"_cache"]],[1491,1491],[1497,1497]]],[1525074319693,["fangle@fangle-PC",[[1,1497,"\n\n"]],[1497,1497],[1498,1498]]],[1525074321778,["fangle@fangle-PC",[[1,1486,"- "]],[1486,1486],[1488,1488]]],[1525074323936,["fangle@fangle-PC",[[-1,1500,"\n"],[1,1501,"- da"]],[1500,1500],[1504,1504]]],[1525074324621,["fangle@fangle-PC",[[-1,1502,"da"]],[1504,1504],[1502,1502]]],[1525074326593,["fangle@fangle-PC",[[1,1502,"大文件"]],[1502,1502],[1505,1505]]],[1525074329500,["fangle@fangle-PC",[[1,1505,"分配请求"]],[1505,1505],[1509,1509]]],[1525074335445,["fangle@fangle-PC",[[-1,1506,"配"]],[1507,1507],[1506,1506]]],[1525074339353,["fangle@fangle-PC",[[1,1506,"片"]],[1506,1506],[1507,1507]]],[1525074342536,["fangle@fangle-PC",[[1,1509," ``"]],[1509,1509],[1512,1512]]],[1525074366724,["fangle@fangle-PC",[[1,1511,"slice size"]],[1511,1511],[1521,1521]]]]]]}